<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gran Rifa Solidaria, Séptimos básicos viaje a Pellines 2026</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Un gris claro para el fondo */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            max-width: 700px; /* Un poco más ancho para el nuevo contenido */
            width: 100%;
            background-color: #ffffff;
            border-radius: 1.5rem; /* Bordes más redondeados */
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 30px;
            text-align: center;
        }
        .draw-button, .clear-button {
            background-image: linear-gradient(to right, #6EE7B7 0%, #34D399 51%, #10B981 100%);
            margin: 10px; /* Ajustado para que quepan dos botones */
            padding: 15px 45px;
            text-align: center;
            text-transform: uppercase;
            transition: 0.5s;
            background-size: 200% auto;
            color: white;
            box-shadow: 0 0 20px #eee;
            border-radius: 10px;
            display: inline-block; /* Cambiado a inline-block para que estén en la misma línea */
            width: fit-content;
            cursor: pointer;
            border: none;
            font-weight: 700;
            letter-spacing: 1px;
        }
        .draw-button:hover:not(:disabled), .clear-button:hover:not(:disabled) {
            background-position: right center;
            color: #fff;
            text-decoration: none;
        }
        .draw-button:disabled, .clear-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .number-display {
            font-size: 3rem;
            font-weight: 700;
            color: #10B981;
            margin-top: 10px;
            padding: 15px;
            background-color: #ecfdf5;
            border-radius: 0.75rem;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.06);
        }
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 10px;
        }
        .info-text {
            color: #6B7280;
            font-size: 0.9rem;
            margin-bottom: 20px;
        }
        .card-info-section {
            background-color: #f8fafc;
            border-radius: 1rem;
            padding: 25px;
            margin-top: 25px;
            text-align: left;
            border: 1px solid #e2e8f0;
        }
        .card-info-section h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 15px;
            text-align: center;
        }
        .card-info-section p, .card-info-section ul, .card-info-section li {
            color: #4a5568;
            line-height: 1.6;
        }
        .card-info-section ul {
            list-style-type: disc;
            margin-left: 20px;
            padding-left: 0;
        }
        .button-group {
            display: flex;
            justify-content: center;
            margin-top: 20px;
        }
        .results-table-section {
            margin-top: 40px;
            background-color: #f8fafc;
            border-radius: 1rem;
            padding: 25px;
            border: 1px solid #e2e8f0;
        }
        .results-table-section h3 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .results-table th, .results-table td {
            border: 1px solid #e2e8f0;
            padding: 12px 15px;
            text-align: center;
            font-size: 0.9rem;
        }
        .results-table th {
            background-color: #e2e8f0;
            font-weight: 600;
            color: #374151;
            text-transform: uppercase;
        }
        .results-table tbody tr:nth-child(odd) {
            background-color: #fcfdfe;
        }
        .results-table tbody tr:hover {
            background-color: #f0f4f8;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1 class="text-3xl font-extrabold text-gray-900 mb-6">Gran Rifa Solidaria, Séptimos básicos viaje a Pellines 2026</h1>

        <p class="info-text">
            Haz clic en el botón para generar aleatoriamente el cartón ganador y un número dentro de ese cartón.
            ¡Mucha suerte!
        </p>

        <!-- Sección de Motivo de la Rifa (Actualizada) -->
        <div class="card-info-section">
            <h3>Motivo de la Rifa</h3>
            <p>
                Esta es una <strong>GRAN RIFA SOLIDARIA</strong> con un valor de $1.000 por cartón, organizada
                en beneficio de los Séptimos Básicos 2025 del Colegio St. Thomas Morus,
                para juntar fondos para su viaje a Pellines en 2026.
            </p>
            <p class="mt-4">
                ¡Gracias por tu apoyo y por ser parte de este noble objetivo!
            </p>
        </div>

        <!-- Sección de Premios Sorteados (Actualizada) -->
        <div class="card-info-section">
            <h3>Premios Sorteados</h3>
            <ul class="mt-4">
                <li><strong>1ER PREMIO:</strong> $200.000</li>
                <li><strong>2DO PREMIO:</strong> $100.000</li>
                <li><strong>3ER Y 4TO PREMIO:</strong> $50.000 C/U</li>
            </ul>
            <p class="mt-4">
                Los dineros serán transferidos a la cuenta que el ganador indique.
            </p>
        </div>

        <!-- Controles y resultados del sorteo -->
        <div class="button-group">
            <button id="drawButton" class="draw-button">
                Realizar Sorteo
            </button>
            <button id="clearButton" class="clear-button">
                Limpiar Resultados
            </button>
        </div>

        <!-- Sección de resultados del sorteo -->
        <div class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner">
            <h2 class="section-title">Cartón Sorteado</h2>
            <div id="winningCarton" class="number-display">--</div>
            <p class="text-gray-500 mt-2">El número de cartón sorteado (entre 1 y 230).</p>
        </div>

        <div class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner">
            <h2 class="section-title">Número Sorteado dentro del Cartón</h2>
            <div id="winningNumberInCarton" class="number-display">--</div>
            <p class="text-gray-500 mt-2">El número específico dentro del cartón sorteado (del 1 al 10).</p>
        </div>

        <div class="mt-8 p-6 bg-gray-50 rounded-xl shadow-inner">
            <h2 class="section-title">Boleto Resultado</h2>
            <div id="globalWinningTicket" class="number-display">--</div>
            <p class="text-gray-500 mt-2" id="globalTicketInfo">Este es el identificador único del boleto resultante.</p>
        </div>

        <!-- Mensaje de confirmación -->
        <div id="messageBox" class="hidden mt-6 bg-blue-100 border border-blue-400 text-blue-700 px-4 py-3 rounded relative" role="alert">
            <strong class="font-bold">¡Sorteo realizado!</strong>
            <span class="block sm:inline" id="messageText"></span>
            <span class="absolute top-0 bottom-0 right-0 px-4 py-3 cursor-pointer" onclick="document.getElementById('messageBox').classList.add('hidden');">
                <svg class="fill-current h-6 w-6 text-blue-500" role="button" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><title>Cerrar</title><path d="M14.348 14.849a1.2 1.2 0 0 1-1.697 0L10 11.819l-2.651 3.029a1.2 1.2 0 1 1-1.697-1.697l2.758-3.15-2.759-3.152a1.2 1.2 0 1 1 1.697-1.697L10 8.183l2.651-3.031a1.2 1.2 0 1 1 1.697 1.697l-2.758 3.152 2.758 3.15a1.2 1.2 0
 0 1 0 1.698z"/></svg>
            </span>
        </div>

        <!-- Sección de Tabla de Resultados -->
        <div id="resultsTableSection" class="results-table-section">
            <h3>Historial de Ganadores</h3>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Premio</th>
                        <th>Cartón Ganador</th>
                        <th>Número Interno</th>
                    </tr>
                </thead>
                <tbody id="resultsTableBody">
                    <!-- Los resultados se insertarán aquí por JavaScript -->
                </tbody>
            </table>
        </div>

    </div>

    <script>
        // Obtener referencias a los elementos HTML
        const drawButton = document.getElementById('drawButton');
        const clearButton = document.getElementById('clearButton');
        const winningCartonDisplay = document.getElementById('winningCarton');
        const winningNumberInCartonDisplay = document.getElementById('winningNumberInCarton');
        const globalWinningTicketDisplay = document.getElementById('globalWinningTicket');
        const globalTicketInfo = document.getElementById('globalTicketInfo');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const resultsTableBody = document.getElementById('resultsTableBody');

        // Estado inicial del párrafo de información del boleto ganador
        const initialGlobalTicketInfoText = "Este es el identificador único del boleto resultante.";

        // Definición de los premios en el orden inverso de sorteo
        const prizes = [
            { name: '4to Premio x $50.000' },
            { name: '3er Premio x $50.000' },
            { name: '2do Premio x $100.000' },
            { name: '1er Premio x $200.000' }
        ];

        let currentDrawIndex = 0; // Índice para seguir qué premio se sortea
        let recordedResults = []; // Array para almacenar los resultados de los sorteos ganadores
        let alAguaDrawsRemaining = 0; // Contador de sorteos "al agua" restantes para el premio actual

        /**
         * Genera un número entero aleatorio entre un mínimo y un máximo (ambos inclusive).
         * @param {number} min - El valor mínimo permitido.
         * @param {number} max - El valor máximo permitido.
         * @returns {number} Un número entero aleatorio.
         */
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        /**
         * Animates the display of numbers for a given element, then displays the final value.
         * @param {HTMLElement} displayElement - The HTML element to update with animated numbers.
         * @param {number} min - Minimum random number for animation.
         * @param {number} max - Maximum random number for animation.
         * @param {number} durationMs - Duration of the animation in milliseconds.
         * @param {*} finalValue - The actual winning value to display at the end. Can be a string or number.
         * @param {Function} callback - Function to call after the animation completes.
         * @returns {void}
         */
        function animateDraw(displayElement, min, max, durationMs, finalValue, callback) {
            let startTime = Date.now();
            let intervalId = setInterval(() => {
                if (Date.now() - startTime < durationMs) {
                    displayElement.textContent = getRandomInt(min, max);
                } else {
                    clearInterval(intervalId);
                    displayElement.textContent = finalValue;
                    if (callback) {
                        callback();
                    }
                }
            }, 100);
        }

        /**
         * Renderiza los resultados almacenados en la tabla HTML.
         * @returns {void}
         */
        function renderResultsTable() {
            resultsTableBody.innerHTML = ''; // Limpiar la tabla antes de renderizar
            recordedResults.forEach(result => {
                const row = resultsTableBody.insertRow();
                row.insertCell().textContent = result.prize;
                row.insertCell().textContent = result.carton;
                row.insertCell().textContent = result.internalNumber;
                // La columna 'Boleto' ha sido eliminada del HTML, por lo que no se inserta aquí.
            });
        }

        /**
         * Resets all the displayed results and the history table.
         */
        function clearResults() {
            winningCartonDisplay.textContent = '--';
            winningNumberInCartonDisplay.textContent = '--';
            globalWinningTicketDisplay.textContent = '--';
            globalTicketInfo.textContent = initialGlobalTicketInfoText;
            messageBox.classList.add('hidden');

            currentDrawIndex = 0; // Reiniciar el contador de sorteos
            recordedResults = []; // Vaciar el array de resultados
            renderResultsTable(); // Actualizar la tabla (la dejará vacía)

            // Inicializar alAguaDrawsRemaining para el primer sorteo
            alAguaDrawsRemaining = getRandomInt(2, 4);

            drawButton.disabled = false; // Habilitar el botón de sorteo
            drawButton.textContent = `Realizar Sorteo para el ${prizes[0].name}`; // Actualizar texto del botón
        }

        /**
         * Realiza el sorteo de los números de cartón y los muestra en la interfaz con animación.
         * Deshabilita el botón durante el sorteo.
         * @returns {void}
         */
        function performDraw() {
            if (currentDrawIndex >= prizes.length) {
                // Todos los sorteos han sido realizados
                messageText.textContent = ` ¡Todos los premios han sido sorteados! Presiona "Limpiar Resultados" para comenzar de nuevo.`;
                messageBox.classList.remove('hidden');
                drawButton.disabled = true;
                clearButton.disabled = false;
                return;
            }

            // Deshabilitar los botones durante el sorteo
            drawButton.disabled = true;
            clearButton.disabled = true;

            // Resetear las visualizaciones actuales
            winningCartonDisplay.textContent = '--';
            winningNumberInCartonDisplay.textContent = '--';
            globalWinningTicketDisplay.textContent = '--';
            globalTicketInfo.textContent = initialGlobalTicketInfoText;
            messageBox.classList.add('hidden');

            const currentPrize = prizes[currentDrawIndex];
            // Actualizado el rango para el cartón ganador a 1 y 230
            const finalWinningCarton = getRandomInt(1, 230);

            // 1. Iniciar la animación para el "Cartón Sorteado"
            // Actualizado el rango para la animación del cartón ganador a 1 y 230
            animateDraw(winningCartonDisplay, 1, 230, 10000, finalWinningCarton, () => {
                // Callback una vez que la animación del cartón termina
                const finalWinningNumberInCarton = getRandomInt(1, 10);

                // 2. Iniciar la animación para el "Número Sorteado dentro del Cartón"
                animateDraw(winningNumberInCartonDisplay, 1, 10, 10000, finalWinningNumberInCarton, () => {
                    // Callback una vez que la animación del número interno termina

                    // Mostrar el boleto resultado en el formato "Cartón X - Número Y"
                    globalWinningTicketDisplay.textContent = `${finalWinningCarton} - ${finalWinningNumberInCarton}`;

                    // Actualizar el texto informativo debajo del boleto resultado
                    globalTicketInfo.textContent = `Este boleto corresponde al Cartón ${finalWinningCarton} - Número ${finalWinningNumberInCarton}.`;

                    // Lógica de "Al Agua"
                    if (alAguaDrawsRemaining > 0) {
                        alAguaDrawsRemaining--; // Decrementar contador "al agua"
                        messageText.textContent = ` Lamentablemente te fuiste Al Agua, mejor suerte para la próxima. Quedan ${alAguaDrawsRemaining} sorteos "al agua" para el ${currentPrize.name}.`;
                        messageBox.classList.remove('hidden');
                        
                        // Habilitar el botón para volver a sortear para el MISMO premio
                        drawButton.disabled = false;
                        clearButton.disabled = false;

                    } else {
                        // Este es el sorteo GANADOR para el premio actual
                        // El cálculo de globalWinningTicketNumerical se mantiene para el mensaje de confirmación,
                        // pero no se almacena en la tabla.
                        const globalWinningTicketNumerical = (finalWinningCarton - 1) * 10 + finalWinningNumberInCarton;

                        // Registrar el resultado del sorteo GANADOR (sin globalTicket)
                        recordedResults.push({
                            prize: currentPrize.name,
                            carton: finalWinningCarton,
                            internalNumber: finalWinningNumberInCarton,
                        });
                        renderResultsTable(); // Actualizar la tabla con el nuevo resultado

                        // Mostrar mensaje de confirmación de ganador
                        messageText.textContent = ` ¡${currentPrize.name} ha sido sorteado! El cartón ganador es el ${finalWinningCarton}, con el número interno ${finalWinningNumberInCarton}.`;
                        messageBox.classList.remove('hidden');

                        currentDrawIndex++; // Pasar al siguiente premio
                        if (currentDrawIndex < prizes.length) {
                            // Si hay más premios, inicializar el contador "al agua" para el siguiente premio
                            alAguaDrawsRemaining = getRandomInt(2, 4);
                            drawButton.textContent = `Realizar Sorteo para el ${prizes[currentDrawIndex].name}`;
                            drawButton.disabled = false; // Habilitar para el siguiente sorteo
                        } else {
                            // Todos los premios han sido sorteados
                            drawButton.textContent = 'Todos los Sorteos Completados';
                            drawButton.disabled = true;
                        }
                        clearButton.disabled = false; // Habilitar el botón de limpiar
                    }
                });
            });
        }

        // Asignar los eventos a los botones
        drawButton.addEventListener('click', performDraw);
        clearButton.addEventListener('click', clearResults);

        // Configuración inicial al cargar la página
        window.onload = () => {
            clearResults(); // Asegura que la tabla y displays estén limpios y el botón con el texto correcto
        };
    </script>
</body>
</html>
